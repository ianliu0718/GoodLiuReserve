<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
	<script src="script.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css"/>
  </head>
  <body id="item" class="formbody">
	<div id="divProgress" style="text-align:center; display: none; position: fixed; top: 50%;  left: 50%;" >
		<img ID="imgLoading" src="Loading.gif" alt="Loading...">
		<br />
		<font color="#1B3563" size="2px">資料處理中</font>
	</div>
	<div id="divMaskFrame" style="background-color: #F2F4F7; display: none; left: 0px;
		position: absolute; top: 0px;">
	</div>
  </body>
  <script>
	ShowProgressBar();
	liff.init({
		liffId: '1656397971-O01ydwmn'
	})
	.then(() => {
		if(!liff.isLoggedIn()){
			liff.login();
		}
		liff.getProfile()
		.then(profile => {
			console.log(profile);
			GetDataToGAS(profile.userId);
		})
		.catch((err) => {
			console.log('error', err);
		});
	})
	function GetDataToGAS(uerId){
		//v1.0.4版
		var data_url = "https://script.google.com/macros/s/AKfycbzltaHJ0GRxzYgOEi4ViItXQq8gTnLrkAC3QRJ8lOo0Y69J7TE7YO6um_Y5Jq94rQFn/exec";
		
		$.ajax({
		type: "GET",
		dataType: "json",
		url: data_url,
		data: uerId ,
		success: function(response) {
			//alert("成功");
			console.log(response);
			addItems(response);
			HideProgressBar();
		},
		error: function(){alert("失敗！")}
		});
	}
	
	//動態新增
	function addItems(object){
		var tableTitleArray = ["姓名", "性別", "電話", "預約日期", "預約時間", "預約據點", "預估金額", "預約項目"]
		//獲取div
		var div = document.createElement("div");
		//設置屬性
		div.innerHTML = jsonToHtmlTable(tableTitleArray, object);
		document.getElementById("item").appendChild(div);
	}
	
	function jsonToHtmlTable(tableTitleArray, object) {
		var html = '';
		//個人資料
		html += '<table class="table"><thead style="text-align:left;"><tr>';
		html += '<th colspan="'+object.length+'">姓名：'+object[0]["姓名"]+'<br>'
		html += '性別：'+object[0]["性別"]+'<br>'
		html += '電話：'+object[0]["電話"]
		html += '</tr></thead>';
		
		//預約資料Title
		html += '<table class="table"><thead><tr><th>#</th>';
		for (var i = 3; i < tableTitleArray.length; i++) {
			if (tableTitleArray[i] == "預約項目") {
			html += '<th colspan="'+object[0]["預約項目"].length+'">' + tableTitleArray[i] + '</th>';
			} else {
			html += '<th>' + tableTitleArray[i] + '</th>';
			}
		}
		html += '</tr></thead>';
		
		//預約資料Data
		html += '<tbody>';
		for (var i = 3; i < object.length; i++) {
			html += '<tr><td>' + i + '</td>';
			for (var j = 3; j < tableTitleArray.length; j++) {
				if (tableTitleArray[j] == "預約項目") {
					for (var k in object[i].預約項目) {
					html += '<td>' + object[i][tableTitleArray[j]][k] + '</td>';
					}
				} else {
					html += '<td>' + object[i][tableTitleArray[j]] + '</td>';
				}
			}
			html += '</tr>';
		}
		html += '</tbody></table>';
		return html;
	}
  </script>
  <style>
	body, table {
		margin-top: 10px;
	}
	th,td {
		padding: 10px;
	}
	th {
		font: bold 18px "";
	}
	td {
		font: 14px "";
		text-align: center;
	}
  </style>
</html>
